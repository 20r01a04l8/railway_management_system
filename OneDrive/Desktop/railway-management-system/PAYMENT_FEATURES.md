# Payment System Features\n\nThis document describes the new payment system features added to the Railway Management System.\n\n## Features Added\n\n### 1. Multiple Payment Methods\n- **Wallet**: Digital wallet with add money functionality\n- **Credit Cards**: Save and manage multiple credit cards\n- **UPI IDs**: Save and manage multiple UPI IDs\n\n### 2. Default Balances\n- **Credit Cards**: ₹100,000 default balance when added\n- **UPI IDs**: ₹100,000 default balance when added\n- **Wallet**: Starts with ₹0, can add money as needed\n\n### 3. Transaction History\n- Complete transaction history for all payment methods\n- Track debits and credits with descriptions\n- Reference IDs for booking payments\n\n### 4. Profile Management\n- Dedicated profile page to manage payment methods\n- View balances for all payment methods\n- Add new payment methods\n- View transaction history\n\n## Database Changes\n\n### New Tables\n1. **upi_ids**: Store user UPI IDs with balances\n2. **card_transactions**: Track credit card transactions\n3. **upi_transactions**: Track UPI transactions\n\n### Modified Tables\n1. **credit_cards**: Added balance column (default 100,000)\n\n## API Endpoints\n\n### Credit Cards\n- `POST /payments/credit-cards` - Add new credit card\n- `GET /payments/credit-cards` - Get user's credit cards\n- `GET /payments/credit-cards/{card_id}/transactions` - Get card transactions\n\n### UPI IDs\n- `POST /payments/upi-ids` - Add new UPI ID\n- `GET /payments/upi-ids` - Get user's UPI IDs\n- `GET /payments/upi-ids/{upi_id}/transactions` - Get UPI transactions\n\n### Wallet\n- `GET /payments/wallet` - Get wallet balance\n- `POST /payments/wallet/add-money` - Add money to wallet\n- `GET /payments/wallet/transactions` - Get wallet transactions\n\n### Payments\n- `POST /payments/process` - Process payment (supports all methods)\n- `GET /payments/` - Get user's payment history\n\n### Authentication\n- `GET /auth/me` - Get current user information\n\n## Frontend Pages\n\n### 1. Payment Page (payment.html)\n- Select payment method (Wallet, Credit Card, UPI)\n- Add new payment methods during checkout\n- Use saved payment methods\n- Process payments with balance deduction\n\n### 2. Profile Page (profile.html)\n- View profile information\n- Manage wallet (add money, view transactions)\n- Manage credit cards (add new, view transactions)\n- Manage UPI IDs (add new, view transactions)\n\n## Usage Instructions\n\n### 1. Setup\n1. Run the database migration: `mysql -u root -p railway_db < database/payment_updates.sql`\n2. Start the backend server: `python main.py`\n3. Open the frontend: `http://localhost:3000`\n\n### 2. Adding Payment Methods\n\n#### Credit Card\n1. Go to Profile page or during payment\n2. Click \"Add Card\"\n3. Fill in card details (16-digit number, name, expiry, CVV, type)\n4. Card is saved with ₹100,000 balance\n\n#### UPI ID\n1. Go to Profile page or during payment\n2. Click \"Add UPI ID\"\n3. Enter UPI ID (must contain @)\n4. UPI ID is saved with ₹100,000 balance\n\n#### Wallet\n1. Go to Profile page\n2. Click \"Add Money\"\n3. Enter amount and confirm\n4. Money is added to wallet\n\n### 3. Making Payments\n1. Select a train and book tickets\n2. Choose payment method:\n   - **Wallet**: Uses wallet balance\n   - **Credit Card**: Select saved card or add new one\n   - **UPI**: Select saved UPI ID or add new one\n3. Confirm payment\n4. Amount is deducted from selected payment method\n5. Transaction is recorded\n\n### 4. Viewing Transactions\n1. Go to Profile page\n2. Click \"Transactions\" button for any payment method\n3. View complete transaction history\n\n## Security Features\n\n1. **Card Number Masking**: Only last 4 digits shown\n2. **CVV Protection**: Never stored in database\n3. **JWT Authentication**: All endpoints protected\n4. **Input Validation**: Proper validation for all inputs\n5. **SQL Injection Protection**: Using SQLAlchemy ORM\n\n## Error Handling\n\n1. **Insufficient Balance**: Prevents payment if balance is low\n2. **Invalid Payment Methods**: Validates payment method selection\n3. **Duplicate Payments**: Prevents multiple payments for same booking\n4. **Authentication**: Requires valid JWT token\n\n## Testing\n\n### Test Scenarios\n1. Add credit card with valid details\n2. Add UPI ID with valid format\n3. Add money to wallet\n4. Make payment with each method\n5. View transaction history\n6. Check balance deduction\n\n### Sample Data\n- Credit Card: 1234567890123456, John Doe, 12/2025, 123, Visa\n- UPI ID: test@upi, user@paytm, example@gpay\n- Wallet: Add ₹1000, ₹5000, etc.\n\n## Future Enhancements\n\n1. **Payment Gateway Integration**: Real payment processing\n2. **Refund System**: Handle booking cancellations\n3. **Payment Limits**: Set daily/monthly limits\n4. **Payment Notifications**: Email/SMS notifications\n5. **Payment Analytics**: Spending reports\n6. **Auto-reload**: Automatic wallet top-up\n7. **Payment Scheduling**: Recurring payments\n\n## Troubleshooting\n\n### Common Issues\n1. **Database Connection**: Check MySQL service and credentials\n2. **Migration Errors**: Ensure database exists and user has permissions\n3. **CORS Issues**: Check API base URL in frontend\n4. **Token Expiry**: Re-login if authentication fails\n\n### Logs\n- Backend logs: Console output from FastAPI\n- Frontend logs: Browser developer console\n- Database logs: MySQL error logs\n\n## Support\n\nFor issues or questions:\n1. Check the troubleshooting section\n2. Review API documentation\n3. Check browser console for errors\n4. Verify database schema matches migration